<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Client Notes Manager (Firebase)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:20px;
    background:#f0f0f0; color:#222;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background:#121212; color:#eee;
  }
  .container {
    max-width:700px; margin:auto;
    background:#fff; padding:20px;
    border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15);
  }
  body.dark .container {
    background:#222;
  }
  h1, h2 {
    margin-top:0;
  }
  label {
    font-weight:bold; display:block; margin-bottom:6px;
  }
  select, input[type=password], input[type=text], textarea {
    width:100%; padding:8px; font-size:1em;
    margin-bottom:12px; border:1px solid #ccc; border-radius:4px;
    background:#fff; color:#222;
    box-sizing: border-box;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark select, body.dark input[type=password], body.dark input[type=text], body.dark textarea {
    background:#333; color:#eee; border-color:#555;
  }
  textarea {
    height:180px; resize: vertical;
  }
  button {
    cursor:pointer; padding:10px 16px; font-size:1em;
    border:none; border-radius:4px; background:#007bff; color:#fff;
    transition: background-color 0.3s;
  }
  button:hover {
    background:#0056b3;
  }
  button.secondary {
    background:#28a745;
  }
  button.ghost {
    background:transparent; color:#007bff; border:1px solid #007bff;
  }
  button.ghost:hover {
    background:#007bff; color:#fff;
  }
  .flex-row {
    display:flex; justify-content:space-between; align-items:center;
  }
  .flex-row > * {
    margin-right:10px;
  }
  .flex-row > *:last-child {
    margin-right:0;
  }
  .error {
    color:#c00; margin-bottom:12px;
  }
  .saved-text {
    font-size:0.9em; color:#555; margin-top:8px;
  }
  body.dark .saved-text {
    color:#bbb;
  }
  .lang-select {
    max-width:150px;
  }
  ul.client-list {
    list-style:none; padding-left:0;
    max-height: 150px; overflow-y: auto;
    border:1px solid #ccc; border-radius:4px;
    margin-bottom: 16px;
  }
  ul.client-list li {
    padding: 8px;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
  }
  ul.client-list li:hover {
    background: #e7f0ff;
  }
  body.dark ul.client-list li:hover {
    background: #444;
  }
  ul.client-list li.selected {
    background: #007bff; color: #fff;
  }
  body.dark ul.client-list li.selected {
    background: #3399ff;
  }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>
<div id="app" class="container" aria-live="polite"></div>

<script>
(() => {
  // Firebase config - replace with your actual config if different
  const firebaseConfig = {
    apiKey: "AIzaSyBVk1hAiKIu_Qf0Js4x2VPNvcVlJxc7ebY",
    authDomain: "clients-notes.firebaseapp.com",
    projectId: "clients-notes",
    storageBucket: "clients-notes.firebasestorage.app",
    messagingSenderId: "573296430958",
    appId: "1:573296430958:web:68ab8324fbc3efaa7f7b7f",
    measurementId: "G-19SVZ9NYLR"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Translations (simplified for brevity)
  const translations = {
    en: {
      loginTitle: "Login",
      username: "Username",
      password: "Password",
      loginButton: "Login",
      incorrectLogin: "Incorrect login. Use username between 201 and 209 and password 88.",
      logout: "Logout",
      language: "Language:",
      clientListTitle: "Clients",
      newClientPlaceholder: "New client name",
      addClientButton: "Add Client",
      notesTitle: "Notes for",
      notesPlaceholder: "Write notes here...",
      saveNotes: "Save Notes",
      notesSaved: "Notes saved successfully.",
      deleteClient: "Delete Client",
      noClients: "No clients yet. Add one!",
      dark: "Dark Mode",
      light: "Light Mode"
    }
  };

  const validUsers = Array.from({length:9}, (_,i) => `20${i+1}`);
  const passwordRequired = "88";

  let state = {
    loggedIn: false,
    username: validUsers[0],
    password: "",
    language: "en",
    clients: [],
    selectedClient: null,
    darkMode: false,
    errorMsg: "",
    newClientName: ""
  };

  const app = document.getElementById("app");

  // Save dark mode preference to localStorage
  function updateDarkMode() {
    if(state.darkMode) document.body.classList.add("dark");
    else document.body.classList.remove("dark");
  }

  // Render login page
  function renderLogin() {
    const t = translations[state.language];
    app.innerHTML = `
      <h1>${t.loginTitle}</h1>
      <div>
        <label for="username-select">${t.username}</label>
        <select id="username-select" aria-label="${t.username}">
          ${validUsers.map(u=>`<option value="${u}"${state.username===u?" selected":""}>${u}</option>`).join("")}
        </select>
      </div>
      <div>
        <label for="password-input">${t.password}</label>
        <input type="password" id="password-input" aria-label="${t.password}" autocomplete="current-password" />
      </div>
      <button id="login-btn">${t.loginButton}</button>
      <div id="error-msg" class="error" role="alert" aria-live="assertive">${state.errorMsg}</div>
    `;

    document.getElementById("username-select").addEventListener("change", (e) => {
      state.username = e.target.value;
    });
    document.getElementById("login-btn").addEventListener("click", () => {
      state.password = document.getElementById("password-input").value.trim();
      if(validUsers.includes(state.username) && state.password === passwordRequired) {
        state.loggedIn = true;
        state.errorMsg = "";
        loadClients();
      } else {
        state.errorMsg = t.incorrectLogin;
        renderLogin();
      }
    });
  }

  // Load clients from Firestore and listen for real-time updates
  function loadClients() {
    db.collection("clients").orderBy("name").onSnapshot(snapshot => {
      state.clients = [];
      snapshot.forEach(doc => {
        state.clients.push({ id: doc.id, name: doc.data().name, notes: doc.data().notes || "" });
      });
      if(state.selectedClient && !state.clients.find(c => c.id === state.selectedClient.id)) {
        state.selectedClient = null; // selected client was deleted
      }
      renderApp();
    });
  }

  // Render main app UI
  function renderApp() {
    updateDarkMode();
    const t = translations[state.language];
    app.innerHTML = `
      <div class="flex-row" style="margin-bottom:12px;">
        <label for="lang-select">${t.language}</label>
        <select id="lang-select" class="lang-select" aria-label="${t.language}">
          <option value="en"${state.language==="en"?" selected":""}>English</option>
        </select>

        <button id="toggle-dark-btn" class="ghost" aria-label="Toggle dark mode">${state.darkMode ? t.light : t.dark}</button>
        <button id="logout-btn" class="ghost">${t.logout}</button>
      </div>

      <h2>${t.clientListTitle}</h2>
      <ul class="client-list" role="listbox" aria-label="${t.clientListTitle}">
        ${state.clients.length ? state.clients.map(client => `
          <li tabindex="0" role="option" aria-selected="${state.selectedClient && state.selectedClient.id===client.id}" class="${state.selectedClient && state.selectedClient.id===client.id ? "selected" : ""}">${client.name}</li>
        `).join("") : `<li>${t.noClients}</li>`}
      </ul>
      <input type="text" id="new-client-name" placeholder="${t.newClientPlaceholder}" aria-label="${t.newClientPlaceholder}" value="${state.newClientName}" />
      <button id="add-client-btn">${t.addClientButton}</button>
      <hr />
      <h2>${t.notesTitle} ${state.selectedClient ? state.selectedClient.name : ""}</h2>
      <textarea id="notes-textarea" placeholder="${t.notesPlaceholder}" aria-label="${t.notesPlaceholder}" ${state.selectedClient ? "" : "disabled"}>${state.selectedClient ? state.selectedClient.notes : ""}</textarea>
      <div style="margin-top:12px;">
        <button id="save-btn" ${state.selectedClient ? "" : "disabled"}>${t.saveNotes}</button>
        <button id="delete-client-btn" ${state.selectedClient ? "" : "disabled"} class="secondary">${t.deleteClient}</button>
      </div>
      <div class="saved-text" id="save-message"></div>
    `;

    document.getElementById("lang-select").addEventListener("change", e => {
      state.language = e.target.value;
      renderApp();
    });

    document.getElementById("toggle-dark-btn").addEventListener("click", () => {
      state.darkMode = !state.darkMode;
      updateDarkMode();
      renderApp();
    });

    document.getElementById("logout-btn").addEventListener("click", () => {
      state.loggedIn = false;
      state.selectedClient = null;
      renderLogin();
    });

    document.querySelectorAll("ul.client-list li").forEach(li => {
      if(li.textContent === t.noClients) return;
      li.addEventListener("click", () => {
        const client = state.clients.find(c => c.name === li.textContent);
        if(client) {
          state.selectedClient = client;
          renderApp();
        }
      });
      li.addEventListener("keydown", e => {
        if(e.key === "Enter" || e.key === " ") {
          const client = state.clients.find(c => c.name === li.textContent);
          if(client) {
            state.selectedClient = client;
            renderApp();
          }
        }
      });
    });

    const newClientInput = document.getElementById("new-client-name");
    newClientInput.addEventListener("input", e => {
      state.newClientName = e.target.value;
    });
    newClientInput.addEventListener("keydown", e => {
      if(e.key === "Enter") addClient();
    });

    document.getElementById("add-client-btn").addEventListener("click", addClient);

    function addClient() {
      const name = state.newClientName.trim();
      if(!name) return alert("Please enter a client name.");
      if(state.clients.find(c => c.name.toLowerCase() === name.toLowerCase())) return alert("Client already exists.");
      db.collection("clients").add({ name, notes: "" })
        .then(() => {
          state.newClientName = "";
          renderApp();
        })
        .catch(err => alert("Error adding client: " + err.message));
    }

    const notesTextarea = document.getElementById("notes-textarea");
    notesTextarea.addEventListener("input", () => {
      if(state.selectedClient) {
        state.selectedClient.notes = notesTextarea.value;
      }
    });

    document.getElementById("save-btn").addEventListener("click", () => {
      if(state.selectedClient) {
        db.collection("clients").doc(state.selectedClient.id).update({ notes: state.selectedClient.notes })
          .then(() => {
            const msg = document.getElementById("save-message");
            msg.textContent = t.notesSaved;
            setTimeout(() => { msg.textContent = ""; }, 3000);
          })
          .catch(err => alert("Error saving notes: " + err.message));
      }
    });

    document.getElementById("delete-client-btn").addEventListener("click", () => {
      if(state.selectedClient && confirm(`Delete client "${state.selectedClient.name}"?`)) {
        db.collection("clients").doc(state.selectedClient.id).delete()
          .then(() => {
            state.selectedClient = null;
            renderApp();
          })
          .catch(err => alert("Error deleting client: " + err.message));
      }
    });
  }

  // Start
  if(state.loggedIn) {
    loadClients();
  } else {
    renderLogin();
  }
})();
</script>
</body>
</html>
